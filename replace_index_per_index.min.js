#!/usr/bin/env node

/**
 * In case of you have a index file for production environment (called index.min.html) this script removes 'index.html'
 * and then renames 'index.min.html' to 'index.html'.
 */

// Modules
var
 fs                    = require('fs')
,walk                  = require('walk')
,path                  = require('path')

// Process
,rootDir               = process.argv[2]
,platformPath          = path.join(rootDir, 'platforms')
,platforms             = process.env.CORDOVA_PLATFORMS.split(',');

// Run uglifier
run();

/**
 * Run compression for all specified platforms.
 * @return {undefined}
 */
function run() {
  platforms.forEach(function(platform) {
    var wwwPath;

    switch (platform) {
      case 'android':
        wwwPath = path.join(platformPath, platform, 'assets', 'www'); // platform/android/assets/www
        break;

      case 'ios':
      case 'browser':
      case 'wp8':
        wwwPath = path.join(platformPath, platform, 'www'); // platform/ios/www
        break;

      default:
        console.log('this hook only supports android, ios, wp8, and browser currently');
        return;
    }

    fs.unlink( path.join(wwwPath, 'index.html' ), function() {
      fs.rename(path.join(wwwPath, 'index.min.html' ), path.join(wwwPath, 'index.html' ));
    } );
  });
}
